configfile: "config/config.yaml"

report: "report/workflow.rst"

rule all:
	input:
		slurm_ass = "results/slurm_ass.out"

rule assemble_data:
	input: 
		fwd_list = config["trimmed_fastq_fwd_loc_list"],
		bwd_list = config["trimmed_fastq_bwd_loc_list"]
	output:
		slurm_ass = "results/slurm_ass.out"
			#THUS FAR ONLY WORKS FOR FIRST ITEM IN ASS_DATA
	params:
		meth = config["assembly_meth"],
		ass_thresh = config["assemble_thresh"],
		threads = config["threads"],
		spm = config["spades_py_memory"],
		spades_path = config["spades_path"],	
		nodes = config["nodes"],
		cpus = config["cpus"],
		memory = config["memory"],
		runtime = config["runtime"],
		partition = config["partition"],
		ex_need = config["ex_need"],
		run_name = config["run_name"]
	shell:
		'''
		sbatch \
		--job-name={params.run_name} \
		--nodes={params.nodes} \
		--ntasks={params.cpus} \
		--mem={params.memory} \
		--time={params.runtime} \
		--partition={params.partition} \
		--{params.ex_need} \
		workflow/scripts/assemble_meat.sh \
		{input.fwd_list} \
		{input.bwd_list} \
		{params.meth} \
		{params.ass_thresh} \
		{params.threads} \
		{params.spm} \
		{params.spades_path} \
		> {output.slurm_ass}
		'''

rule assemble_report:
	input:
		#insert here
	output:
		ass_rep = "workflow/report/assemble_report.txt",
	params:
		meth = config["assembly_meth"],
		name = config["run_name"],
		fwd_list = config["trimmed_fastq_fwd_loc_list"],
                bwd_list = config["trimmed_fastq_bwd_loc_list"]
	shell:
		"bash workflow/scripts/assemble_report.sh {params.fwd_list} {params.bwd_list} {params.meth} {params.name} > {output.ass_rep}"
					

